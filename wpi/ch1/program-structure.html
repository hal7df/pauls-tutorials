<html>
  <head>
    <title>1-2 Program Structure (WPI)</title>
    <meta content="">
    <link rel="stylesheet" type="text/css" href="../../style.css" />
  </head>
  <body>
  	<!-- ACTIVITY SCRIPT -->
  	<script type="text/javascript" >
  	<!--
  	function toggleDesc() {
  		but = document.getElementById("showDesc");
  		desc = document.getElementById("sampleDesc");
  		
  		if (desc.style.display == "none")
  		{
  			desc.style.display = "block";
  			but.innerHTML = "Hide sample";
  		}
  		else {
  			desc.style.display = "none";
  			but.innerHTML = "Show sample";
  		}
  	}
  	//-->
  	</script>
   <!-- PAGE HEADER -->
	<h1 class ="tutorial" style="line-height: 60px;"><img src="http://www.hotteam67.org/wp-content/uploads/2015/01/PaulsTutorials.png" alt="Paul's Tutorials - logo" 
  		style="float: left; vertical-align: middle;" height="60" width="63">&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 0.5em;">1-2</span>&nbsp;Program Structure</h1>
  	<hr />
  	<div><a href="http://hotteam67.org/programming" title="Programming Home">Programming Home</a>&nbsp;&gt;&nbsp;<a href="../pauls-tutorials.html" title="Paul's Tutorials">Paul's Tutorials</a>
  		&gt;&nbsp;<a href="http://www.hotteam67.org/programming/pauls-tutorials/wpi" title="WPILib Tutorial">WPILib Tutorial</a>
 		&gt;&nbsp;<a href="../ch1.html">Chapter 1</a>&nbsp;&gt;&nbsp;Lesson 2
  		</div>	
  	<hr />
  	
  	<p>Now that we have reviewed what makes up the robot, we can move on to how the program is structure.</p>
  	<p>If you still don&#x27;t understand classes, you NEED to study up on that before you continue.</p>
  	<p><a href="http://www.cplusplus.com/doc/tutorial/classes/" target="_blank">Part 1</a>&nbsp;&#9899;&nbsp;<a href="http://www.cplusplus.com/doc/tutorial/classes2/" target="_blank">Part 2</a></p>
  	<ul>
  		<li><a href="#Introduction">Introduction</a></li>
  		<li><a href="#Getting_Started">Getting Started</a></li>
  		<li><a href="#Class_Members">Class Members</a></li>
  		<li><a href="#Class_Constructor">Class Constructor</a></li>
  		<li><a href="#Initialization_Routines">Initialization Routines</a></li>
  		<ul>
  			<li><a href="#RobotInit"><code>RobotInit()</code></a></li>
  			<li><a href="#DisabledInit"><code>DisabledInit()</code></a></li>
  			<li><a href="#AutonomousInit"><code>AutonomousInit()</code></a></li>
  			<li><a href="#TeleopInit"><code>TeleopInit()</code></a></li>
  			<li><a href="#TestInit"><code>TestInit</code></a></li>
  		</ul>
  		<li><a href="#Periodic_Routines">Periodic Routines</a></li>
  		<ul>
  			<li><a href="#DisabledPeriodic"><code>DisabledPeriodic()</code></a></li>
  			<li><a href="#AutonomousPeriodic"><code>AutonomousPeriodic()</code></a></li>
  			<li><a href="#TeleopPeriodic"><code>TeleopPeriodic()</code></a></li>
  			<li><a href="#TestPeriodic"><code>TestPeriodic</code></a></li>
  		</ul>
  		<li><a href="#Continuous_Routines">Continuous Routines</a></li>
  		<ul>
  			<li><a href="#DisabledContinuous"><code>DisabledContinuous()</code></a></li>
  			<li><a href="#AutonomousContinuous"><code>AutonomousContinuous()</code></a></li>
  			<li><a href="#TeleopContinuous"><code>TeleopContinuous()</code></a></li>
  			<li><a href="#TestContinuous"><code>TestContinuous()</code></a></li>
  		</ul>
  		<li><a href="#End_of_the_Program">End of the Program</a></li>
  		<li><a href="#Activity">Activity</a></li>
  	</ul>
  	
  	<h2 class="tutorial"><a name="Introduction"></a>Introduction</h2>
  		<p>The robot&#x27;s program is a little different from what you are used to. Instead of using an <code>int main</code> and a lot of functions, you program the robot as a class. And only a class. 
  		The <code>int main</code> portion of the program doesn&#x27;t change, so it is already embedded into the rRIO for you.</p>
  		<p>The underlying program on the rRIO reads the class that you wrote, and applies it to the robot. So, essentially, you are treating the robot as if it were a class.</p>
  	<h2 class="tutorial"><a name="Getting_Started"></a>Getting Started</h2>
  		<p>When you installed the WPI Eclipse extension, you installed a robot class template. In order to get it, go to File &gt; New &gt; Project. In the dialog, select <q>Robot C++ Project</q>, then <q>Iterative Robot</q>, then give your project a name.
  		This will load all of the required files into your workspace (there are some other underlying files that you don&#x27;t touch). The file you want is in the <q>src</q> directory, <q>Robot.cpp</q>. Let&#x27;s examine what it has done for us: </p>
  		<pre lang="cpp" escaped="true">
#include &quot;WPILib.h&quot;
		</pre>
		<p>This includes the library which, in turn, includes all of the functions of the robot that you could ever want.</p>
		<pre lang="cpp">
class Robot: public IterativeRobot
		</pre>
		<p>This creates a new class called <code>Robot</code> that you will program. It inherits the <code>IterativeRobot</code> class, the class the rRIO treats the robot as.
		Your class <span style="font-weight: bold;">MUST</span> inherit <code>IterativeRobot</code>, otherwise it will not work.</p>
		<p>Now, we will look at the structure of the robot class.</p>
	<h2 class="tutorial"><a name="Class_Members"></a>Class Members</h2>
		<pre lang="cpp">
class Robot: public IterativeRobot
{
  	/*Put the components of your robot here.
  	 *...
  	 */
   	</pre>
   	<p>Here is where you declare everything that your robot has: drive controllers, sensors, etc. You also declare variables that you will use for control here, as well.</p>
   	<p>There is a specific way in which we declare robot components -- that is, using pointers. But we&#x27;ll get into that later.</p>
   <h2 class="tutorial"><a name="Class_Constructor"></a>Class Constructor</h2>
		<p>The default code actually does not include this part, but you should write it in. If you remember from the C++ Guided Tutorial, the constructor is the part of the class where it initializes itself.</p>
   	<pre lang="cpp">
Robot::Robot()
{
	//Initialize robot components here
}
		</pre>
		<p>The class constructor is used to initialize parts of the robot and to set variables for their initial run. This is called before the <a href="#RobotInit">RobotInit()</a> method in the program.
			An example usage of the constructor: </p>
		<pre lang="cpp">
public:
	Robot::Robot()
	{
		m_Victor1 = new Victor(1);
		m_Counter = 0;
	}
		</pre>
		<p>Again, how to initialize specific robot components will be reviewed in <a href="parts-code.html">Lesson 1-3</a>.</p>
		<p>You may notice the <code>public:</code> keyword before the class constructor. Everything declared before is private, to avoid memory overflow.</p>
	<h2 class="tutorial"><a name="Initialization_Routines"></a>Initialization Routines</h2>
		<p style="font-style: italic;">Not to be confused with the component initialization in the <a href="#Class_Constructor">constructor</a></p>
		<p>The following routines are called once before their corresponding <a href="#Periodic_Routines">periodic routines</a> are called. Note that <a href="#RobotInit">RobotInit</a> does not have a periodic routine associated with it.</p>
		<p>One important concept to note at this point is that the rRIO operates in loops. It runs an init routine in one loop, then it switches to the corresponding periodic routine.
			The periodic routine runs once per loop until the mode is changed, and the process is repeated again for the new mode.</p>
		<h3 class="tutorial"><a name="RobotInit"></a><code>RobotInit()</code></h3>
			<pre lang="cpp">
void Robot::RobotInit()
{
  // Actions which would be performed once (and only once) upon initialization of the
  // robot would be put here.
}
			</pre>
			<p>The comment says it all -- everything that is not component and variable initialization that you want to do before the robot does anything else (e.g. sending things to the dashboard, if necessary).</p>
		<h3 class="tutorial"><a name="DisabledInit"></a><code>DisabledInit()</code></h3>
			<pre lang="cpp">
void BuiltinDefaultCode::DisabledInit()
{
	// Actions that are to be called as the robot enters disabled mode would be put here
}
			</pre>
			<p>Disabled routines, or when <q>Disabled</q> is selected in the driver station, are routines in which you can change variables, but you cannot change the state of the robot (i.e. activate motors). The most common use for this mode is to change between autonomous modes.
				In the <code>DisabledInit</code> portion of the program, you would put statements that you want run as the robot enters disabled mode.</p>
		<h3 class="tutorial"><a name="AutonomousInit"></a><code>AutonomousInit()</code></h3>
			<pre lang="cpp">
void Robot::AutonomousInit()
{
	// Put actions that should be run as the autonomous period of the match starts here.
}
			</pre>
{
			<p>Autonomous is the part of the match where the robot functions without input from the drivers (with the exception of the Kinect and other video devices).
				If there are some actions that need to be run as you enter autonomous, put them here.</p>
		<h3 class="tutorial"><a name="TeleopInit"></a><code>TeleopInit()</code></h3>
			<pre lang="cpp">
void Robot::TeleopInit()
{
	// Put actions that should be run once teleoperated operation starts here.
}
			</pre>
			<p>Teleop, short for teleoperated, is when the drivers control the robot through the controls. This initialization routine is important, as it is often used to stop any leftover autonomous commands, should they run past their allocated period. It can also be used to reset the robot to a certain state after autonomous ends.</p>
		<h3 class="tutorial"><a name="TestInit"></a><code>TestInit()</code></h3>
			<pre lang="cpp">
void Robot::TestInit()
{
	// Put setup for diagnostics here
}
			</pre>
			<p>Test mode is an important mode: you can use it to test the functionality of your robot. Essentially, it is a diagnostic mode that you can use to determine exactly what is wrong with your robot.</p>
			<p>In TestInit, you would set your robot up for diagnostics, if any are needed.</p>
	<h2 class="tutorial"><a name="Periodic_Routines"></a>Periodic Routines</h2>
		<p>These are all routines that are run once the rRIO has finished the initialization stage for that specific mode (e.g. teleop). These continue to run, once per loop until the robot is disabled (in matches, the robot is disabled for a short period of time after autonomous to switch to teleop).
			Because they loop automatically, you should <span style="font-weight: bold;">never</span> write a loop into these routines.</p>
		<h3 class="tutorial"><a name="DisabledPeriodic"></a><code>DisabledPeriodic()</code></h3>
			<pre lang="cpp">
void Robot::DisabledPeriodic()
{
	//Put methods to be run while your robot is disabled here
}
			</pre>
			<p>Here is where you would program your robot to change autonomous modes, tune in a shot height, etc. Again, you cannot interact with drive controllers or anything that actuates parts of the robot here.</p>
		<h3 class="tutorial"><a name="AutonomousPeriodic"></a><code>AutonomousPeriodic()</code></h3>
			<pre lang="cpp">
void Robot::AutonomousPeriodic()
{
	//Put methods that make up your autonomous routine here.
}
			</pre>
			<p><code>AutonomousPeriodic()</code> is what runs during the autonomous portion of the match. Here, you write the robot&#x27;s autonomous routine.</p>
			<p>Note that, depending on the complexity of your autonomous, this can be the part of your program that requires the most logic.</p>
		<h3 class="tutorial"><a name="TeleopPeriodic"></a><code>TeleopPeriodic()</code></h3>
			<pre lang="cpp">
void Robot::TeleopPeriodic()
{
	//Put methods that would be run during teleop here.
}
			</pre>
			<p>Here is where you put in all of your teleop functionality, which includes but is not limited to:</p>
			<ul>
				<li>Driving</li>
				<li>Controlling devices (such as shooters and arms) and PIDs</li>
				<li>Updating the driver station and dashboard </li>
			</ul>
			<p>Because this is easily one of the largest parts of the program (although there are a few exceptions), it is better to organize this, such that all of your teleop functionality is split up amongst organized functions.
				For example, if you wanted to drive your robot and update the dashboard, your <code>TeleopPeriodic()</code> would look like this:</p>
			<pre lang="cpp">
void Robot::TeleopPeriodic()
{
	TeleopDrive();
	TeleopDashboardUpdate();
}

void Robot::TeleopDrive()
{
	//Methods for driving the robot here
}

void Robot::TeleopDashboardUpdate()
{
	//Update the driver station here
}
			</pre>
			<p><span style="font-weight: bold;">Note:</span> This will become even more apparent as the tutorial progresses, but <span style="font-weight: bold;">PLEASE</span> name your functions and variables with relevant names.
				Not doing so will cause a lot of ripped-out hair and shouting voices.</p>
		<h3 class="tutorial"><a name="TestPeriodic"></a><code>TestPeriodic()</code></h2>
			<pre lang="cpp">
void Robot::TestPeriodic()
{
	// Put diagnostic routines here.
}
			</pre>
			<p>Here, you would put all of your diagnostics. In the case of this tutorial, you would use game controller buttons to test individual motors and specific robot functions.</p>
			<p>Diagnostics are important because they help you determine the exact problem with your robot, should one arise. You should always program a diagnostic mode.</p>
	<h2 class="tutorial"><a name="Continuous_Routines"></a>Continuous Routines</h2>
		<p>Continuous routines are similar to periodic routines, in that they are called over and over again. However, they can run multiple times per loop, and they take higher priority over periodic routines.
			Because of this, using these too much can lead to a runaway process thread and memory issues. Use these with caution, if at all.</p>
		<h3 class="tutorial"><a name="DisabledContinuous"></a><code>DisabledContinuous()</code></h3>
			<pre lang="cpp">
void Robot::DisabledContinuous()
{
	//...
}
			</pre>
			<p>This is the continuous routine that runs in disabled mode.</p>
		<h3 class="tutorial"><a name="AutonomousContinuous"></a><code>AutonomousContinuous()</code></h3>
			<pre lang="cpp">
void Robot::AutonomousContinuous()
{
	//...
}
			</pre>
			<p>This is the continuous routine that runs in autonomous.</p>
		<h3 class="tutorial"><a name="TeleopContinuous"></a><code>TeleopContinuous()</code></h3>
			<pre lang="cpp">
void Robot::TeleopContinuous()
{
	//...
}
			</pre>
			<p>This is the continuous routine that runs in teleop.</p>
		<h3 class="tutorial"><a name="TestContinuous"></a><code>TestContinuous()</code></h3>
			<pre lang="cpp">
void Robot::TestContinuous()
{
	//...
}
			</pre>
			<p>This is the continuous routine that runs in test mode.</p>
	<h2 class="tutorial"><a name="End_of_the_Program"></a>End of the Program</h2>
		<p>At the end of the program, you may notice the following line:</p>
		<pre lang="cpp">
START_ROBOT_CLASS(Robot);
		</pre><p>This is a macro that basically tells the rRIO that the class <code>Robot</code> is the class to load and use on the robot.</p>
	<h2 class="tutorial"><a name="Activity"></a>Activity</h2>
	<p>Alone or with a partner, talk to a mentor/veteran team member to get a detailed description of all of the functions of a robot from a previous year (this activity does not require that the robot is available, but it may be useful for your reference).</p>
	<p>Below is the class template discussed in this lesson, and in each function is a multi-line comment with an editable text box. Using the description you obtained, fill in the comments so that all of the functions (and any basic logic, if possible) are in the right place.</p>
	<p>Click the button below to see a sample function description (of the 2013 HOTBOT)</p>
	<button id="showDesc" onclick="toggleDesc()">Show sample</button>
	<ul id="sampleDesc" style="display: none;">
		<li style="text-decoration: underline;">While disabled:</li>
			<ul>
				<li>Adjust shot height</li>
				<li>Change between two autonomous modes</li>
			</ul>
		<li style="text-decoration: underline;">In autonomous:</li>
			<ul>
				<li>Go to selected autonomous mode</li>
				<ul>
					<li>One drives to the center, one to the side</li>
				</ul>
				<li>Set shot height to requested offset from the default</li>
				<li>Spin up launcher</li>
				<li>Fire 3 frisbees into the top goal</li>
				<li>Back up to center line</li>
			</ul>
		<li style="text-decoration: underline;">In teleop:</li>
			<ul>
				<li>Drive</li>
				<li>Turn on/off launcher, adjust shot speed if necessary</li>
				<li>Fire frisbees using a feeder</li>
				<li>Use the climber, with lock safeguard</li>
				<li>Update the driver station and dashboard</li>
			</ul>
		<li>It must also have a diagnostic mode.</li>
	</ul>
	<noscript>
		<p style="font-style: italic;">Javascript is disabled. The sample is shown below.</p>
		<ul>
		<li style="text-decoration: underline;">While disabled:</li>
			<ul>
				<li>Adjust shot height</li>
				<li>Change between two autonomous modes</li>
			</ul>
		<li style="text-decoration: underline;">In autonomous:</li>
			<ul>
				<li>Go to selected autonomous mode</li>
				<ul>
					<li>One drives to the center, one to the side</li>
				</ul>
				<li>Set shot height to requested offset from the default</li>
				<li>Spin up launcher</li>
				<li>Fire 3 frisbees into the top goal</li>
				<li>Back up to center line</li>
			</ul>
		<li style="text-decoration: underline;">In teleop:</li>
			<ul>
				<li>Drive</li>
				<li>Turn on/off launcher, adjust shot speed if necessary</li>
				<li>Fire frisbees using a feeder</li>
				<li>Use the climber, with lock safeguard</li>
				<li>Update the driver station and dashboard</li>
			</ul>
		<li>It must also have a diagnostic mode.</li>
	</ul>
	</noscript>
	<p>There is no auto-check for this activity. If you want to check your work, talk to a mentor or veteran team member.</p>
	<hr>	
	<pre lang="cpp">
#include "WPILib.h"
	
class Lesson2: public IterativeRobot
{
	/*
	</pre>
	<textarea style="margin-left: 70px;" rows="5" cols="25" placeholder="Declarations"></textarea>
	<pre lang="cpp">
 	 */
	     
public:
	BulitinDefaultCode ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Object/Variable init"></textarea>
	<pre lang="cpp">
		 */
	}

	/** INITIALIZATION ROUTINES **/
		
	void RobotInit ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Robot init"></textarea>	
	<pre lang="cpp">
		 */     
	}
		
	void DisabledInit ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Initialization for disabled mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void AutonomousInit ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Initialization for autonomous mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void TestInit ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Initialization for test mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	/** PERIODIC ROUTINES **/
	
	void DisabledPeriodic ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Disabled mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void AutonomousPeriodic ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Autonomous mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void TeleopPeriodic ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Teleoperated mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void TestPeriodic ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Test mode"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	/** CONTINUOUS ROUTINES **/
		
	// **Use these with caution!**
		
	void DisabledContinuous ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Disabled continuous"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void AutonomousContinuous ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Autonomous continuous"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void TeleopContinuous ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Teleoperated continuous"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	void TestContinuous ()
	{
		/*
	</pre>
	<textarea style="margin-left: 135px;" rows="5" cols="25" placeholder="Test continuous"></textarea>	
	<pre lang="cpp">
		 */
	}
		
	/** MISCELLANEOUS ROUTINES **/
		
	/* Here is where you would put the extra functions that aren't
	 * a part of the class template. (Example: TeleopDrive(), or a
	 * function that does something across both Teleop and Auton,
	 * like printing data). Note that I haven't put the box in a comment -- 
	 * this means that you need to write the function syntax and put 
	 * the comment in there! (Indentation is not necessary FOR THIS ACTIVITY ONLY)
	 */
		 
	</pre>
	<textarea style="margin-left: 70px;" rows="10" cols="50" placeholder="Miscellaneous functions"></textarea>
	<pre lang="cpp"> 
};
START_ROBOT_CLASS(Lesson2);
	</pre>
	
	<!-- NAVIGATION -->
  	<div style="clear: both;">
  		<hr>
	  	<p align="center" style="font-size: 0.75em;">WPILIB TUTORIAL</p>
  		<table border="0" style="width: 100%;">
  			<tbody>
  				<tr>
  					<td style="text-align: right; width: 40%;"><a href="parts.html">&#8592; 1-1 Parts of the Robot</a></td>
  					<td style="text-align: center; font-weight: bold; width: 20%;">1-2 Program Structure</td>
  					<td style="text-align: left; width: 40%;"><a href="parts-code.html">1-3 Parts of the Robot: In Code &#8594;</a></td>
  				</tr>
  			</tbody>
  		</table>
  	</div>
  </body>
</html>